{"version":3,"file":"pages/index/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://eco-viz-mini/./src/pages/index/index.tsx?63ff","webpack://eco-viz-mini/._src_pages_index_index.tsx"],"sourcesContent":["import _regenerator from \"/Users/insentek/WorkSpace/insentek-web/eco-viz-mini-program/eco-viz-mini/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"/Users/insentek/WorkSpace/insentek-web/eco-viz-mini-program/eco-viz-mini/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/Users/insentek/WorkSpace/insentek-web/eco-viz-mini-program/eco-viz-mini/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useEffect, useState } from 'react';\nimport { View, Text } from '@tarojs/components';\nimport Taro, { useDidShow } from '@tarojs/taro';\nimport { checkLoginStatus, navigateToWebViewLoginSimple } from '../../utils/auth';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default function IndexPage() {\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    hasChecked = _useState2[0],\n    setHasChecked = _useState2[1];\n\n  // 首次加载检查\n  useEffect(function () {\n    checkLoginAndRedirect();\n  }, []);\n\n  // 页面显示时检查（包括从 webview 返回的情况）\n  useDidShow(function () {\n    if (!hasChecked) return;\n\n    // 已经从 webview 返回，重新检查登录状态\n    checkLoginAndRedirect();\n  });\n  var checkLoginAndRedirect = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n      var loginResult, _t, _t2;\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.p = _context.n) {\n          case 0:\n            setHasChecked(true);\n            _context.p = 1;\n            _context.n = 2;\n            return checkLoginStatus();\n          case 2:\n            loginResult = _context.v;\n            if (!loginResult.isLoggedIn) {\n              _context.n = 3;\n              break;\n            }\n            // 已登录，跳转到首页\n            Taro.redirectTo({\n              url: '/pages/home/index',\n              fail: function fail() {\n                // 如果 redirectTo 失败，使用 reLaunch\n                Taro.reLaunch({\n                  url: '/pages/home/index'\n                });\n              }\n            });\n            _context.n = 4;\n            break;\n          case 3:\n            _context.n = 4;\n            return navigateToWebViewLoginSimple();\n          case 4:\n            _context.n = 9;\n            break;\n          case 5:\n            _context.p = 5;\n            _t = _context.v;\n            console.error('检查登录状态失败:', _t);\n            // 发生错误时，尝试登录\n            _context.p = 6;\n            _context.n = 7;\n            return navigateToWebViewLoginSimple();\n          case 7:\n            _context.n = 9;\n            break;\n          case 8:\n            _context.p = 8;\n            _t2 = _context.v;\n            console.error('跳转到登录页失败:', _t2);\n            Taro.showToast({\n              title: '登录失败，请重试',\n              icon: 'none',\n              duration: 3000\n            });\n          case 9:\n            return _context.a(2);\n        }\n      }, _callee, null, [[6, 8], [1, 5]]);\n    }));\n    return function checkLoginAndRedirect() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  return /*#__PURE__*/_jsx(View, {\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      height: '100vh',\n      flexDirection: 'column',\n      gap: '20px'\n    },\n    children: /*#__PURE__*/_jsx(Text, {\n      children: \"\\u6B63\\u5728\\u521D\\u59CB\\u5316...\"\n    })\n  });\n}","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/index/index!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"eco-viz\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/index/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}