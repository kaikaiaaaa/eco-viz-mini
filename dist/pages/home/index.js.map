{"version":3,"file":"pages/home/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1rBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://eco-viz-mini/./src/pages/home/index.tsx?7622","webpack://eco-viz-mini/._src_pages_home_index.tsx"],"sourcesContent":["import _defineProperty from \"/Users/insentek/WorkSpace/insentek-web/eco-viz-mini-program/eco-viz-mini/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"/Users/insentek/WorkSpace/insentek-web/eco-viz-mini-program/eco-viz-mini/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _regenerator from \"/Users/insentek/WorkSpace/insentek-web/eco-viz-mini-program/eco-viz-mini/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"/Users/insentek/WorkSpace/insentek-web/eco-viz-mini-program/eco-viz-mini/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/Users/insentek/WorkSpace/insentek-web/eco-viz-mini-program/eco-viz-mini/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useState, useEffect } from 'react';\nimport { View, Text, Image, Input } from '@tarojs/components';\nimport { AtTabs, AtTabsPane, AtList, AtActivityIndicator, AtMessage, AtSegmentedControl } from 'taro-ui';\nimport Taro from '@tarojs/taro';\nimport api from '../../utils/api';\nimport { navigateToWebViewLoginSimple, getAuthHeaders } from '../../utils/auth';\nimport 'taro-ui/dist/style/index.scss';\nimport './index.scss';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nvar redirectingToLogin = false;\n\n// 导入设备图标\nvar iconSq = require('../../assets/images/icon-sq.png');\nvar iconQx = require('../../assets/images/icon-qx.png');\nvar iconZhishang = require('../../assets/images/icon-zhishang.png');\nvar iconTianqiqxz = require('../../assets/images/icon-tianqiqxz.png');\n// 导入搜索图标\nvar iconSearch = require('../../assets/images/icon-search.png');\n\n// 设备图标列表\nvar deviceIconList = [{\n  connectorIdentifier: 'huayi',\n  deviceType: '1',\n  icon: iconSq\n}, {\n  connectorIdentifier: 'huayi',\n  deviceType: '2',\n  icon: iconQx\n}, {\n  connectorIdentifier: 'ecois',\n  deviceType: '1',\n  icon: iconZhishang\n}, {\n  connectorIdentifier: 'ecois',\n  deviceType: '2',\n  icon: iconTianqiqxz\n}];\n\n// 获取设备图标\nvar getDeviceIcon = function getDeviceIcon(connectorIdentifier, deviceType) {\n  var icon = deviceIconList.find(function (item) {\n    return item.connectorIdentifier === connectorIdentifier && item.deviceType === deviceType;\n  });\n  return icon ? icon.icon : null;\n};\n\n// 格式化相对时间\nvar formatRelativeTime = function formatRelativeTime(timestamp) {\n  if (!timestamp) {\n    return '从未上报';\n  }\n  try {\n    var deviceLastUpdate = new Date(timestamp);\n    var now = new Date();\n    var diffMinutes = Math.floor((now.getTime() - deviceLastUpdate.getTime()) / 1000 / 60);\n    if (diffMinutes < 1) {\n      return '刚刚';\n    } else if (diffMinutes < 60) {\n      return \"\".concat(diffMinutes, \"\\u5206\\u949F\\u524D\");\n    } else if (diffMinutes < 1440) {\n      // 24小时\n      var diffHours = Math.floor(diffMinutes / 60);\n      return \"\".concat(diffHours, \"\\u5C0F\\u65F6\\u524D\");\n    } else {\n      var diffDays = Math.floor(diffMinutes / 1440);\n      return \"\".concat(diffDays, \"\\u5929\\u524D\");\n    }\n  } catch (error) {\n    return '从未上报';\n  }\n};\n\n// 格式化地理位置\nvar formatLocation = function formatLocation(item) {\n  if (item.province && item.city && item.district) {\n    return \"\".concat(item.province, \"\\u7701\").concat(item.city, \"\\u5E02\").concat(item.district, \"\\u533A\");\n  } else if (item.country && item.province && item.city) {\n    return \"\".concat(item.country).concat(item.province, \"\\u7701\").concat(item.city, \"\\u5E02\");\n  }\n  return item.location || '--';\n};\nexport default function HomePage() {\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    userInfo = _useState2[0],\n    setUserInfo = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  var _useState5 = useState([]),\n    _useState6 = _slicedToArray(_useState5, 2),\n    groups = _useState6[0],\n    setGroups = _useState6[1];\n  var _useState7 = useState(0),\n    _useState8 = _slicedToArray(_useState7, 2),\n    tabIdx = _useState8[0],\n    setTabIdx = _useState8[1];\n  var _useState9 = useState({}),\n    _useState0 = _slicedToArray(_useState9, 2),\n    listsByGroup = _useState0[0],\n    setListsByGroup = _useState0[1];\n  var _useState1 = useState(''),\n    _useState10 = _slicedToArray(_useState1, 2),\n    searchValue = _useState10[0],\n    setSearchValue = _useState10[1];\n  var _useState11 = useState(''),\n    _useState12 = _slicedToArray(_useState11, 2),\n    searchKeyword = _useState12[0],\n    setSearchKeyword = _useState12[1]; // 实际用于搜索的关键词\n  var _useState13 = useState('all'),\n    _useState14 = _slicedToArray(_useState13, 2),\n    deviceTypeFilter = _useState14[0],\n    setDeviceTypeFilter = _useState14[1]; // 设备类型筛选：all, 1, 2\n\n  useEffect(function () {\n    loadUserInfo();\n  }, []);\n  useEffect(function () {\n    if (!loading) {\n      initGroupsAndFirstPage();\n    }\n  }, [loading]);\n  var loadUserInfo = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n      var accessToken, loginTimestamp, expiresIn, now, tokenAge, maxAge, cachedUser, meResp, data, _t, _t2;\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.p = _context.n) {\n          case 0:\n            _context.p = 0;\n            accessToken = Taro.getStorageSync('logto_token');\n            loginTimestamp = Taro.getStorageSync('login_timestamp');\n            expiresIn = Taro.getStorageSync('token_expires_in');\n            if (!(!accessToken || !loginTimestamp || !expiresIn)) {\n              _context.n = 2;\n              break;\n            }\n            if (redirectingToLogin) {\n              _context.n = 1;\n              break;\n            }\n            redirectingToLogin = true;\n            _context.n = 1;\n            return navigateToWebViewLoginSimple();\n          case 1:\n            return _context.a(2);\n          case 2:\n            now = Date.now();\n            tokenAge = now - loginTimestamp;\n            maxAge = expiresIn * 1000;\n            if (!(tokenAge > maxAge)) {\n              _context.n = 4;\n              break;\n            }\n            if (redirectingToLogin) {\n              _context.n = 3;\n              break;\n            }\n            redirectingToLogin = true;\n            _context.n = 3;\n            return navigateToWebViewLoginSimple();\n          case 3:\n            return _context.a(2);\n          case 4:\n            redirectingToLogin = false;\n            cachedUser = Taro.getStorageSync('user_info');\n            if (cachedUser) setUserInfo(cachedUser);\n            setLoading(false);\n            if (cachedUser) {\n              _context.n = 8;\n              break;\n            }\n            _context.p = 5;\n            _context.n = 6;\n            return Taro.request({\n              url: \"\".concat(process.env.TARO_APP_BASE_API || '', \"/api/me/data\"),\n              method: 'GET',\n              header: getAuthHeaders()\n            });\n          case 6:\n            meResp = _context.v;\n            if (meResp.statusCode === 200 && meResp.data && meResp.data.code === 0) {\n              data = meResp.data.data;\n              if (data !== null && data !== void 0 && data.user) {\n                Taro.setStorageSync('user_info', data.user);\n                setUserInfo(data.user);\n              }\n            }\n            _context.n = 8;\n            break;\n          case 7:\n            _context.p = 7;\n            _t = _context.v;\n          case 8:\n            _context.n = 10;\n            break;\n          case 9:\n            _context.p = 9;\n            _t2 = _context.v;\n            Taro.atMessage({\n              message: '登录信息获取失败',\n              type: 'error'\n            });\n            setLoading(false);\n          case 10:\n            return _context.a(2);\n        }\n      }, _callee, null, [[5, 7], [0, 9]]);\n    }));\n    return function loadUserInfo() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var initGroupsAndFirstPage = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n      var resp, _resp$data, list, _t3;\n      return _regenerator().w(function (_context2) {\n        while (1) switch (_context2.p = _context2.n) {\n          case 0:\n            _context2.p = 0;\n            _context2.n = 1;\n            return api.getMiniGroups();\n          case 1:\n            resp = _context2.v;\n            if (!((resp === null || resp === void 0 ? void 0 : resp.code) === 0)) {\n              _context2.n = 2;\n              break;\n            }\n            list = ((_resp$data = resp.data) === null || _resp$data === void 0 ? void 0 : _resp$data.groups) || []; // 去掉\"全部\"选项\n            setGroups(list);\n            if (!(list.length > 0 && !listsByGroup[String(list[0].id)])) {\n              _context2.n = 2;\n              break;\n            }\n            setTabIdx(0);\n            _context2.n = 2;\n            return loadDevices(list[0].id, true);\n          case 2:\n            _context2.n = 4;\n            break;\n          case 3:\n            _context2.p = 3;\n            _t3 = _context2.v;\n            setGroups([]);\n          case 4:\n            return _context2.a(2);\n        }\n      }, _callee2, null, [[0, 3]]);\n    }));\n    return function initGroupsAndFirstPage() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var ensureGroupState = function ensureGroupState(gid) {\n    var key = String(gid);\n    if (!listsByGroup[key]) {\n      setListsByGroup(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, _defineProperty({}, key, {\n          list: [],\n          page: 0,\n          hasMore: true,\n          loading: false\n        }));\n      });\n    }\n  };\n  var loadDevices = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(gid) {\n      var refresh,\n        key,\n        cur,\n        nextPage,\n        params,\n        resp,\n        data,\n        merged,\n        _args3 = arguments,\n        _t4;\n      return _regenerator().w(function (_context3) {\n        while (1) switch (_context3.p = _context3.n) {\n          case 0:\n            refresh = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : false;\n            key = String(gid);\n            ensureGroupState(gid);\n            cur = listsByGroup[key] || {\n              list: [],\n              page: 0,\n              hasMore: true,\n              loading: false\n            };\n            if (!(!refresh && (cur.loading || !cur.hasMore))) {\n              _context3.n = 1;\n              break;\n            }\n            return _context3.a(2);\n          case 1:\n            nextPage = refresh ? 1 : cur.page + 1;\n            setListsByGroup(function (prev) {\n              return _objectSpread(_objectSpread({}, prev), {}, _defineProperty({}, key, _objectSpread(_objectSpread({}, cur), {}, {\n                loading: true\n              })));\n            });\n            _context3.p = 2;\n            params = {\n              groupId: gid,\n              page: nextPage,\n              pageSize: 20\n            };\n            if (searchKeyword.trim()) {\n              params.search = searchKeyword.trim();\n            }\n            if (deviceTypeFilter !== 'all') {\n              params.devicetype = deviceTypeFilter;\n            }\n            _context3.n = 3;\n            return api.getMiniDevices(params);\n          case 3:\n            resp = _context3.v;\n            if ((resp === null || resp === void 0 ? void 0 : resp.code) === 0) {\n              data = resp.data;\n              merged = refresh ? data.list : cur.list.concat(data.list);\n              setListsByGroup(function (prev) {\n                return _objectSpread(_objectSpread({}, prev), {}, _defineProperty({}, key, {\n                  list: merged,\n                  page: data.page,\n                  hasMore: data.hasMore,\n                  loading: false\n                }));\n              });\n            } else {\n              setListsByGroup(function (prev) {\n                return _objectSpread(_objectSpread({}, prev), {}, _defineProperty({}, key, _objectSpread(_objectSpread({}, cur), {}, {\n                  loading: false\n                })));\n              });\n            }\n            _context3.n = 5;\n            break;\n          case 4:\n            _context3.p = 4;\n            _t4 = _context3.v;\n            setListsByGroup(function (prev) {\n              return _objectSpread(_objectSpread({}, prev), {}, _defineProperty({}, key, _objectSpread(_objectSpread({}, cur), {}, {\n                loading: false\n              })));\n            });\n          case 5:\n            return _context3.a(2);\n        }\n      }, _callee3, null, [[2, 4]]);\n    }));\n    return function loadDevices(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  // 搜索防抖处理\n  useEffect(function () {\n    var timer = setTimeout(function () {\n      setSearchKeyword(searchValue);\n    }, 500); // 500ms 防抖\n    return function () {\n      return clearTimeout(timer);\n    };\n  }, [searchValue]);\n\n  // 搜索关键词变化时重新加载\n  useEffect(function () {\n    if (!loading && groups.length > 0 && tabIdx >= 0) {\n      var _groups$tabIdx;\n      // 重置所有分组的状态并重新加载当前分组\n      setListsByGroup({});\n      var currentGroupId = (_groups$tabIdx = groups[tabIdx]) === null || _groups$tabIdx === void 0 ? void 0 : _groups$tabIdx.id;\n      if (currentGroupId) {\n        loadDevices(currentGroupId, true);\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchKeyword, deviceTypeFilter]);\n  var onTabChange = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(idx) {\n      var gid, key;\n      return _regenerator().w(function (_context4) {\n        while (1) switch (_context4.n) {\n          case 0:\n            setTabIdx(idx);\n            gid = groups[idx].id;\n            key = String(gid);\n            if (!(!listsByGroup[key] || listsByGroup[key].list.length === 0)) {\n              _context4.n = 1;\n              break;\n            }\n            _context4.n = 1;\n            return loadDevices(gid, true);\n          case 1:\n            return _context4.a(2);\n        }\n      }, _callee4);\n    }));\n    return function onTabChange(_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var onPullDownRefresh = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5() {\n      return _regenerator().w(function (_context5) {\n        while (1) switch (_context5.n) {\n          case 0:\n            _context5.n = 1;\n            return loadDevices(groups[tabIdx].id, true);\n          case 1:\n            Taro.stopPullDownRefresh();\n          case 2:\n            return _context5.a(2);\n        }\n      }, _callee5);\n    }));\n    return function onPullDownRefresh() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var onReachBottom = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6() {\n      return _regenerator().w(function (_context6) {\n        while (1) switch (_context6.n) {\n          case 0:\n            _context6.n = 1;\n            return loadDevices(groups[tabIdx].id, false);\n          case 1:\n            return _context6.a(2);\n        }\n      }, _callee6);\n    }));\n    return function onReachBottom() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  // @ts-ignore\n  Taro.usePullDownRefresh(onPullDownRefresh);\n  // @ts-ignore\n  Taro.useReachBottom(onReachBottom);\n  var handleSearchChange = function handleSearchChange(value) {\n    setSearchValue(value);\n  };\n  var handleSearchClear = function handleSearchClear() {\n    setSearchValue('');\n    setSearchKeyword('');\n  };\n  var handleDeviceTypeChange = function handleDeviceTypeChange(value) {\n    setDeviceTypeFilter(value);\n    setListsByGroup({});\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsx(View, {\n      style: {\n        minHeight: '100vh',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        background: 'white',\n        fontSize: '18px'\n      },\n      children: \"\\u52A0\\u8F7D\\u4E2D...\"\n    });\n  }\n  if (groups.length === 0) {\n    return /*#__PURE__*/_jsx(View, {\n      style: {\n        minHeight: '100vh',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        background: 'white',\n        fontSize: '18px',\n        color: '#999'\n      },\n      children: \"\\u6682\\u65E0\\u5206\\u7EC4\\u6570\\u636E\"\n    });\n  }\n  var curKey = groups[tabIdx] ? String(groups[tabIdx].id) : '';\n  var curState = listsByGroup[curKey] || {\n    list: [],\n    loading: false,\n    hasMore: true,\n    page: 0\n  };\n  return /*#__PURE__*/_jsxs(View, {\n    className: \"home-page\",\n    children: [/*#__PURE__*/_jsx(AtMessage, {}), /*#__PURE__*/_jsxs(View, {\n      style: {\n        padding: '16px 18px',\n        background: '#fff',\n        borderBottom: '1px solid #ededed'\n      },\n      children: [/*#__PURE__*/_jsxs(View, {\n        style: {\n          background: '#f5f5f5',\n          borderRadius: '8px',\n          padding: '8px 12px',\n          display: 'flex',\n          alignItems: 'center',\n          position: 'relative'\n        },\n        children: [/*#__PURE__*/_jsx(Image, {\n          src: iconSearch,\n          style: {\n            width: '16px',\n            height: '16px',\n            marginRight: '8px'\n          },\n          mode: \"aspectFit\"\n        }), /*#__PURE__*/_jsx(Input, {\n          type: \"text\",\n          value: searchValue,\n          onInput: function onInput(e) {\n            return handleSearchChange(e.detail.value);\n          },\n          placeholder: \"\\u641C\\u7D22\\u8BBE\\u5907\\u540D\\u79F0\\u6216\\u7F16\\u53F7\",\n          placeholderStyle: \"color:#999\",\n          style: {\n            flex: 1,\n            border: 'none',\n            background: 'transparent',\n            fontSize: '14px',\n            outline: 'none'\n          }\n        }), searchValue && /*#__PURE__*/_jsx(Text, {\n          onClick: handleSearchClear,\n          style: {\n            color: '#999',\n            fontSize: '14px',\n            padding: '0 4px',\n            cursor: 'pointer'\n          },\n          children: \"\\u2715\"\n        })]\n      }), /*#__PURE__*/_jsx(View, {\n        style: {\n          marginTop: '12px'\n        },\n        children: /*#__PURE__*/_jsx(AtSegmentedControl, {\n          values: ['全部设备', '墒情设备', '气象设备'],\n          current: deviceTypeFilter === 'all' ? 0 : deviceTypeFilter === '1' ? 1 : 2,\n          onClick: function onClick(index) {\n            var value = index === 0 ? 'all' : index === 1 ? '1' : '2';\n            handleDeviceTypeChange(value);\n          },\n          selectedColor: \"#1B9AEE\"\n        })\n      })]\n    }), /*#__PURE__*/_jsx(AtTabs, {\n      current: tabIdx,\n      tabList: groups.map(function (g) {\n        return {\n          title: \"\".concat(g.name).concat(g.count !== undefined ? '(' + g.count + ')' : '')\n        };\n      }),\n      onClick: onTabChange,\n      height: \"44\",\n      swipeable: true,\n      animated: true,\n      tabDirection: \"horizontal\",\n      customStyle: {\n        background: '#fff',\n        fontSize: '18px'\n      },\n      children: groups.map(function (group, idx) {\n        return /*#__PURE__*/_jsxs(AtTabsPane, {\n          current: tabIdx,\n          index: idx,\n          customStyle: {\n            background: '#f8fafe',\n            padding: 0\n          },\n          children: [curState.loading && curState.list.length === 0 ? /*#__PURE__*/_jsx(View, {\n            style: {\n              display: 'flex',\n              justifyContent: 'center',\n              alignItems: 'center',\n              minHeight: '400px'\n            },\n            children: /*#__PURE__*/_jsx(AtActivityIndicator, {\n              mode: \"normal\",\n              size: 40,\n              content: \"\\u52A0\\u8F7D\\u8BBE\\u5907\\u5217\\u8868...\",\n              color: \"#1B9AEE\"\n            })\n          }) : curState.list.length === 0 ? /*#__PURE__*/_jsxs(View, {\n            className: \"empty\",\n            style: {\n              fontSize: '17px',\n              padding: '36px 0',\n              color: '#bbb'\n            },\n            children: [\"\\u6682\\u65E0 \", group.name, \" \\u8BBE\\u5907\"]\n          }) : /*#__PURE__*/_jsx(AtList, {\n            hasBorder: false,\n            children: curState.list.map(function (item) {\n              var deviceIcon = getDeviceIcon(item.connectorIdentifier || '', item.deviceType || '');\n              var location = formatLocation(item);\n              var lastUpdateTime = formatRelativeTime(item.lastUpdate);\n              return /*#__PURE__*/_jsxs(View, {\n                onClick: function onClick() {\n                  Taro.navigateTo({\n                    url: \"/pages/device-detail/index?id=\".concat(item.id)\n                  });\n                },\n                style: {\n                  display: 'flex',\n                  alignItems: 'center',\n                  padding: '16px 18px',\n                  margin: '0 12px',\n                  borderBottom: '1px solid #f0f0f0',\n                  background: '#fff',\n                  cursor: 'pointer'\n                },\n                children: [deviceIcon && /*#__PURE__*/_jsx(Image, {\n                  src: deviceIcon,\n                  style: {\n                    width: '60px',\n                    height: '75px',\n                    objectFit: 'contain',\n                    marginRight: '12px'\n                  },\n                  mode: \"aspectFit\"\n                }), /*#__PURE__*/_jsxs(View, {\n                  style: {\n                    flex: 1,\n                    display: 'flex',\n                    flexDirection: 'column',\n                    justifyContent: 'space-between'\n                  },\n                  children: [/*#__PURE__*/_jsxs(View, {\n                    children: [/*#__PURE__*/_jsx(Text, {\n                      style: {\n                        fontSize: '16px',\n                        fontWeight: 600,\n                        color: '#222',\n                        display: 'block',\n                        marginBottom: '4px'\n                      },\n                      children: item.name || item.sn\n                    }), /*#__PURE__*/_jsxs(Text, {\n                      style: {\n                        fontSize: '13px',\n                        color: '#999',\n                        display: 'block',\n                        marginBottom: '6px'\n                      },\n                      children: [\"No.\", item.sn]\n                    })]\n                  }), /*#__PURE__*/_jsx(Text, {\n                    style: {\n                      fontSize: '12px',\n                      color: '#999',\n                      display: 'block',\n                      marginBottom: '4px'\n                    },\n                    children: location\n                  }), /*#__PURE__*/_jsx(Text, {\n                    style: {\n                      fontSize: '12px',\n                      color: '#999'\n                    },\n                    children: lastUpdateTime ? \"\".concat(lastUpdateTime, \"\\u4E0A\\u62A5\") : '从未上报'\n                  })]\n                }), /*#__PURE__*/_jsx(Text, {\n                  style: {\n                    color: '#ddd',\n                    fontSize: '18px',\n                    marginLeft: '8px'\n                  },\n                  children: \"\\u203A\"\n                })]\n              }, item.id);\n            })\n          }), curState.loading && curState.list.length !== 0 && /*#__PURE__*/_jsx(AtActivityIndicator, {\n            content: \"\\u52A0\\u8F7D\\u66F4\\u591A...\",\n            size: 26,\n            color: \"#3192ff\"\n          }), !curState.hasMore && curState.list.length > 0 && /*#__PURE__*/_jsx(View, {\n            style: {\n              textAlign: 'center',\n              fontSize: '15px',\n              color: '#aaa',\n              margin: '20px 0 8px 0'\n            },\n            children: \"\\u6CA1\\u6709\\u66F4\\u591A\\u4E86\"\n          })]\n        }, group.id);\n      })\n    })]\n  });\n}","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/home/index!./index.tsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/home/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}